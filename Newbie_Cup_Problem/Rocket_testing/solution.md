## 火箭测试 题解

出题人： 成子谦

### 出题idea

这道题是我在打某场atcoder beginner contest时见到的，原题数据范围比较小，但有较高的精度要求。为了让题目不那么恶心，就改为输出距离的平方，~~让大家开心一下。~~

### 解法

原题可以抽象为如下数学问题：

> 给定一个向量集$S$，选取它的一个子集$S'$并对$S'$中的所有向量求和，使得最终得到的答案向量的模长尽可能大。

有过oi经验的人可能会第一时间想到搜索，这是一个好的想法。这样的做法必然要对向量进行若干次遍历，时间复杂度为$O(Cn)$，$C$为一常数。但往哪个方向搜索、如何搜索，做法因人而异。如果考虑得不够精细，可能会写挂掉，这里不再赘述。

不妨换一个思路，掏出你们的草稿纸并作如下思考：既然我们不知道如何选择向量使得答案向量的模长尽量长，那么我们可以假定一个**新的很长的向量**作为答案向量，并考察该向量和原有向量的关系。

![](/home/jhseng/Code/DailyTraining/Newbie_Cup_Problem/Rocket_testing/Screenshot_20191029_111322.png)

如上图，绿色向量和紫色向量是题目给定的向量，红色向量是我们假定的答案向量。在题目给定的向量中，哪些向量有可能用于组成答案向量呢？如果还不确定，过原点作一条与答案向量垂直的直线(图中蓝色线)，这个问题是不是清晰多了？

显然，图中绿色向量应用于构造答案向量，因为它们与答案向量的夹角不超过$90°$。那么可以得到结论：与最终答案向量夹角不超过$90°$的向量必然对答案有正的贡献。

所以我们得到如下算法：先对所有向量都按斜率排序，再枚举每个向量作为起点，按斜率顺序遍历一次所有的向量，维护$d^2$的最大值即可。该枚举算法的时间复杂度为$O(nlogn+n^2)$。

从时间复杂度来看，这并不是一个最优的做法，但它能保证算法的正确性，而且实现方法非常简单。由于~~这是新生杯啊，怎么能残害祖国的花朵，所以~~n非常小$(1 \le n \le 1000)$，$O(n^2)$的做法是完全可以接受的。~~毕竟看数据范围做题也是ACM的一部分。~~如果有同学用玄学搜索AC了这题，出题人表示~~您真牛逼~~非常欣慰XD。

本题极限数据的答案为$2*(1e^3*1e^6)^2=2e^{18}$，故只需开long long即可。本题具体实现请看标程。
